# Braden Allmond notes on making an hlt menu using hltGetConfiguration
# hltGetConfiguration command at the bottom for mc of recent VBF sample

####### this step isn't necessary but it's the repo you'd need for more advanced testing
# add package with
# git cms-addpkg HLTrigger/Configuration

# Dependencies and Compilation
# git cms-checkdeps -A -a
# scram b -j 6
# rehash
#######

# sometimes a helpful command
# edmDumpEventContent addedhltVBF.root will show you every EDM format products and their classes inside addedhltVBF.root

# test input file from hltGetConfig webpage
# use for testing if you don't have a testing file,
# otherwise use your own testing file but give this option in hltGetConfig to limit the number of events
--max-events 100 \
--input root://cms-xrd-global.cern.ch//store/data/Run2018D/EphemeralHLTPhysics7/RAW/v1/000/323/790/00000/B543D251-40F1-CB46-A6A1-046CF3D78D6D.root \

# from Kyungwook October 27th
# new VBFHToTauTau sample 
# /VBFHToTauTau_M125_TuneCP5_14TeV-powheg-pythia8/Run3Winter21DRMiniAOD-FlatPU30to80FEVT_112X_mcRun3_2021_realistic_v16-v1/GEN-SIM-DIGI-RAW

# first argument is the path in ConfDB that we'd like to make our config file from
# Copy_CMSSW_11_3_GRun_wNewVBF/V1 is the most recent menu for CMSSW_11_3 with our NewVBF path added in

# --globaltag auto:phase1_2021_realistic \ finds a globaltag that works with our CMSSW release automatically for MC
# for data you'd use --globaltag auto:run3_hlt \ instead

# --path argument reruns only the lines we care about, so you can use it to run just ditau, old vbf, and new vbf paths of HLT
# this is very necesary because HLT is heavy, so we should only rerun the parts we need

# --mc or --data tells hltGetConfiguration if the input you provide is mc or data 

# --unprescale should unprescale your L1s (i've not verified this, but it's used in all the twikis i've seen)

# --output none should reduce output to terminal (another option is "minimal" but i don't see a difference between the two...)

# --process MYHLT  ?

# --full also ?

# --offline this is used as opposed to --online, which configures HLT differently for the different environment

# --max-events 5000 this lets you limit (or not limit) the number of events you use from a file when testing

# we have to re-emulate L1 for our seed so we use --l1-emulator uGT \ and a custom l1XML file that we direct hltGetConfiguration to
# with --l1Xml and the name of our modified file

# --l1 and --l1Xml are different options. --l1 points to files hltGetConfiguration should already know exist, 
# --l1Xml are more specific, usually user files
# we'll need the second kind to test our seed idea directly since we have to customise the L1 xml file
# to include DoubleJet35_Mass_Min450_IsoTau45_RmvOl's Tau Eta cut and make the dR cut 0p5 instead of 0p2

# --input [file] specifies the input file to use in the config (this is the file that's accessed when you test your configuration
# interactively with cmsRun hlt_NewVBF.py)

# the last line of the command directs the config to a file that we'll then use cmsRun on 

# additional notes for running on data

# timing studies run on DATA so we use --data \ and --timing \

# an additional customisation is necessary for all Run3 data testing, which is what anything >= CMSSW_11_3
# so if you use --data in your command, add this --customise argument
# --customise HLTrigger/Configuration/customizeHLTforCMSSW.customiseFor2018Input \
# updates something about pixel tracking changing btwn runs 2 and 3

# "\" is a line continuation character and just makes this easier to read. If you run this command 
# and then arrow up to it in terminal, all the options will be mushed together but it'll still run

hltGetConfiguration /users/ballmond/Copy_CMSSW_11_3_GRun_wNewVBF/V1 \
--globaltag auto:phase1_2021_realistic \
--path HLTriggerFirstPath,HLT_DoubleTightChargedIsoPFTauHPS40_Trk1_eta2p1_Reg_v1,HLT_VBF_DoubleTightChargedIsoPFTauHPS20_Trk1_eta2p1_v1,HLT_VBF_TightChargedIsoPFTauHPS50_PFTauHPS20_Trk1_eta2p1_v*,HLTriggerFinalPath,HLTAnalyzerEndpath \
--mc \
--unprescale \
--output none \
--process MYHLT \
--full \
--offline \
--max-events 5000 \
--l1-emulator uGT \
--l1Xml L1Menu_Collisions2020_v0_1_8_fixed.xml \
--input root://cms-xrd-global.cern.ch///store/mc/Run3Winter21DRMiniAOD/VBFHToTauTau_M125_TuneCP5_14TeV-powheg-pythia8/GEN-SIM-DIGI-RAW/FlatPU30to80FEVT_112X_mcRun3_2021_realistic_v16-v1/270000/005b56c1-0107-46b3-9740-1c6efc559295.root \
> hlt_NewVBF.py

# input for data needs to be a good run number. You can find the run number in the output of an interactive cmsRun, and then
# search that job number in OMS like this (https://cmsoms.cern.ch/cms/runs/report?cms_run=324097&cms_run_sequence=GLOBAL-RUN)
# there's no data for the run shown (324097), which means it's a bad run. Instead, try https://cmsoms.cern.ch/cms/runs/report?cms_run=325098&cms_run_sequence=GLOBAL-RUN
# There's clearly data here, and when you do an interactive cmsRun the output looks more normal (multiple L1s fired)
# You can find input files corresponding to that run number using CMS DAS like this
# file dataset=/EphemeralZeroBias1/Run2018D-v1/RAW run=325098
# link to file: https://cmsweb.cern.ch/das/request?view=list&limit=50&instance=prod%2Fglobal&input=file+dataset%3D%2FEphemeralZeroBias1%2FRun2018D-v1%2FRAW+run%3D325098
# Thanks Kyungwook for showing me how!

hltGetConfiguration /users/ballmond/Copy_CMSSW_11_3_GRun_wNewVBF/V1 \
--globaltag auto:run3_hlt \
--path HLTriggerFirstPath,HLT_DoubleTightChargedIsoPFTauHPS40_Trk1_eta2p1_Reg_v1,HLT_VBF_DoubleTightChargedIsoPFTauHPS20_Trk1_eta2p1_v1,HLT_VBF_TightChargedIsoPFTauHPS50_PFTauHPS20_Trk1_eta2p1_v*,HLTriggerFinalPath,HLTAnalyzerEndpath \
--data \
--customise HLTrigger/Configuration/customizeHLTforCMSSW.customiseFor2018Input \
--unprescale \
--output none \
--process MYHLT \
--full \
--offline \
--max-events 5000 \
--l1-emulator uGT \
--l1Xml L1Menu_Collisions2020_v0_1_8_fixed.xml \
--input root://cms-xrd-global.cern.ch//store/data/Run2018D/EphemeralZeroBias1/RAW/v1/000/325/098/00000/B11474B6-7775-D54D-805E-5FFE0391D401.root \
> hlt_forData_NewVBF.py

# new hltGetConfiguration for new iteration of path (checking DeepTauID)
#hltGetConfiguration /users/ballmond/Copy_CMSSW_12_2_0_pre2_GRun_wDeepTauDiTaus/V1 \
hltGetConfiguration /users/ballmond/GRun_w_NewVBF_and_DeepTauDoubleTaus/V1 \
--globaltag auto:phase1_2021_realistic \
--path HLTriggerFirstPath,HLT_DoubleTightChargedIsoPFTauHPS35_Trk1_eta2p1_Reg_v1,HLT_DoubleTightDeepTauIsoPFTauHPS35_Trk1_eta2p1_v1,HLT_DoubleTightDeepTauIsoPFTauHPS35_Trk1_L2NN_eta2p1_v1,HLT_VBF_DoubleTightChargedIsoPFTauHPS20_Trk1_eta2p1_v1,HLT_VBF_TightChargedIsoPFTauHPS50_PFTauHPS20_Trk1_eta2p1_v*,HLTriggerFinalPath,HLTAnalyzerEndpath \
--mc \
--unprescale \
--output none \
--process MYHLT \
--full \
--offline \
--max-events 5000 \
--l1-emulator uGT \
--l1Xml L1Menu_Collisions2020_v0_1_8_fixed.xml \
--input root://cms-xrd-global.cern.ch///store/mc/Run3Winter21DRMiniAOD/VBFHToTauTau_M125_TuneCP5_14TeV-powheg-pythia8/GEN-SIM-DIGI-RAW/FlatPU30to80FEVT_112X_mcRun3_2021_realistic_v16-v1/270000/005b56c1-0107-46b3-9740-1c6efc559295.root \
> hlt_DeepTauPrelimTesting.py
